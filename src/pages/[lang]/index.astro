---
import Layout from "../../layouts/Layout.astro";
import ButtonRipple from "../../components/WaterRippleButton.astro";
import PlayRipple from "../../components/PlayRipple.astro";
import OneStopSolution from "../../components/home/OneStopSolution.astro";
import EmsLogos from "../../components/home/EmsLogos.astro";
import EvsLogos from "../../components/home/EvsLogos.astro";
import Vision from "../../components/home/Vision.astro";
import Achievement from "../../components/home/Achievement.astro";
import Certification from "../../components/home/Certification.astro";
import Company from "../../components/home/Company.astro";
import Sustainable from "../../components/home/Sustainable.astro";

// Import i18n & Content Utilities
import { getEntry } from "astro:content";
import { languages } from "../../i18n/utils.js";

// 1. Fungsi getStaticPaths agar satu file ini melayani /en/ dan /zh/
export async function getStaticPaths() {
  return [{ params: { lang: "en" } }, { params: { lang: "zh" } }];
}

const { lang } = Astro.params;

const entryId = lang || "en";

// 3. Panggil getEntry dengan ID yang sudah divalidasi
const entry = await getEntry("homepage", entryId);

// 4. Jika file en.json atau zh.json tidak ditemukan di folder homepage
if (!entry) {
  throw new Error(
    `File JSON tidak ditemukan di src/content/homepage/${entryId}.json`
  );
}
// Gunakan data dari JSON, atau sediakan fallback kosong agar tidak error jika file belum ada
const data = entry?.data || {
  hero: { title: "", subtitle: "", button: "" },
  company: { group: "", profile: "" },
  trusted: { title: "" },
};
// const { data } = entry;
// const data = entry.data;
---

<Layout title="Home">
  <section
    id="hero"
    class="relative min-h-screen overflow-hidden flex items-center"
  >
    <div
      id="hero-bg"
      class="absolute inset-0 bg-cover bg-center bg-no-repeat animate-zoom"
    >
    </div>

    <div class="absolute inset-0 bg-black/50 flex items-center justify-center">
      <div
        id="hero-content"
        class="text-center text-white max-w-5xl mx-auto px-6 py-12 md:py-24"
      >
        <h1
          class="reveal text-3xl sm:text-4xl md:text-5xl lg:text-7xl font-bold mb-6 leading-tight max-w-4xl mx-auto"
        >
          {data.hero.title}
        </h1>

        <p
          class="reveal text-sm sm:text-base md:text-lg mb-8 leading-relaxed opacity-90 max-w-3xl mx-auto"
        >
          {data.hero.subtitle}
        </p>

        <div class="reveal inline-block">
          <ButtonRipple bgColor="bg-primary" textColor="text-white">
            {data.hero.button}
          </ButtonRipple>
        </div>
      </div>
    </div>

    <div
      id="profile-banner"
      class="absolute bottom-0 right-0 w-full sm:w-2/3 lg:w-1/2 bg-white shadow-lg border-t flex items-center p-3 sm:p-4 gap-4 z-20"
    >
      <PlayRipple />
      <div>
        <div
          class="font-medium text-red-500 text-xs sm:text-base uppercase tracking-wider"
        >
          {data.company.group}
        </div>
        <div class="font-semibold text-base sm:text-2xl">
          {data.company.profile}
        </div>
      </div>
    </div>
  </section>

  <div class="section-reveal">
    <OneStopSolution />
  </div>

  <section
    class="section-reveal mt-12 md:mt-20 px-4 bg-slate-50 py-12 md:py-20"
  >
    <h1
      class="text-xl sm:text-3xl md:text-4xl font-bold text-center max-w-4xl mx-auto"
    >
      {data.trusted.title}
    </h1>
    <div class="section-reveal"><EmsLogos /></div>
    <div class="section-reveal"><EvsLogos /></div>
  </section>

  <section class="mt-12 md:mt-20">
    <div
      class="section-reveal w-full h-48 sm:h-52 md:h-64 bg-[url(/images/seragam-biru.webp)] bg-center bg-cover"
    >
    </div>

    <div class="section-reveal"><Vision /></div>
    <div class="section-reveal"><Achievement /></div>
    <div class="section-reveal"><Certification /></div>
    <div class="section-reveal"><Company /></div>
    <div class="section-reveal"><Sustainable /></div>

    <div class="mb-20 sm:mb-64"></div>
  </section>
</Layout>

<script>
  import { gsap } from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";

  gsap.registerPlugin(ScrollTrigger);

  window.addEventListener("DOMContentLoaded", () => {
    const tl = gsap.timeline();

    tl.from(".reveal", {
      y: 30,
      opacity: 0,
      duration: 1,
      stagger: 0.2,
      ease: "power3.out",
      delay: 0.5,
    });

    tl.from(
      "#profile-banner",
      {
        x: 100,
        opacity: 0,
        duration: 0.8,
        ease: "power2.out",
      },
      "-=0.5"
    );
  });

  const sections = document.querySelectorAll(".section-reveal");
  sections.forEach((section) => {
    gsap.from(section, {
      scrollTrigger: {
        trigger: section,
        start: "top 85%",
        toggleActions: "play none none none",
      },
      y: 40,
      opacity: 0,
      duration: 1,
      ease: "power2.out",
    });
  });

  const images = [
    "/images/HEADER-2000x1125-A.webp",
    "/images/HEADER-2000x1125-B.webp",
    "/images/HEADER-2000x1125-C.webp",
    "/images/HEADER-2000x1125-D.webp",
    "/images/HEADER-2000x1125-E.webp",
    "/images/HEADER-2000x1125-F.webp",
    "/images/HEADER-2000x1125-G.webp",
    "/images/HEADER-2000x1125-H.webp",
  ];

  let currentIndex = 0;
  const heroBg = document.getElementById("hero-bg");

  if (heroBg) {
    heroBg.style.backgroundImage = `url(${images[0]})`;
    setInterval(() => {
      currentIndex = (currentIndex + 1) % images.length;
      gsap.to(heroBg, {
        opacity: 0.7,
        duration: 0.3,
        onComplete: () => {
          heroBg.style.backgroundImage = `url(${images[currentIndex]})`;
          gsap.to(heroBg, { opacity: 1, duration: 0.5 });
        },
      });
    }, 5000);
  }
</script>

<style>
  @keyframes zoom {
    from {
      transform: scale(1);
    }
    to {
      transform: scale(1.15);
    }
  }
  .animate-zoom {
    animation: zoom 20s ease-in-out infinite alternate;
    will-change: transform;
  }
  .reveal,
  .section-reveal {
    visibility: visible;
  }
</style>
