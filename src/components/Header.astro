<header
  id="main-header"
  class="fixed top-0 left-0 right-0 z-100 transition-all duration-500 border-b border-transparent py-3 md:py-4"
>
  <div class="mx-auto flex max-w-7xl items-center justify-between px-6">
    <a
      href="/"
      class="nav-brand text-xl font-bold text-white transition-all duration-300 hover:scale-105 active:scale-95"
    >
      <img
        src="/images/yifang-logo.png"
        alt="yifang-logo"
        class="w-30 lg:w-40"
      />
    </a>

    <nav class="hidden items-center md:flex text-white">
      <ul class="flex items-center gap-2 text-sm lg:text-xl">
        <li class="group relative">
          <a
            href="/"
            class="nav-link px-4 py-2 flex items-center transition-all duration-300 hover:text-red-500"
          >
            Home
          </a>
        </li>

        <li class="group relative">
          <button
            class="nav-link px-4 py-2 flex items-center gap-1 transition-all duration-300 outline-none hover:text-red-500"
          >
            Our Companies
            <svg
              class="w-3 h-3 transition-transform duration-300 group-hover:rotate-180"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M19 9l-7 7-7-7"></path>
            </svg>
          </button>

          <div
            class="absolute left-1/2 -translate-x-1/2 top-full pt-3 opacity-0 translate-y-4 pointer-events-none group-hover:opacity-100 group-hover:translate-y-0 group-hover:pointer-events-auto transition-all duration-300 ease-out"
          >
            <div
              class="w-48 rounded-xl border border-slate-200 bg-white shadow-2xl p-2 overflow-hidden"
            >
              {
                ["YSM", "YCME", "YEV", "YAM"].map((item) => (
                  <a
                    href={`/companies/${item.toLowerCase()}`}
                    class="block px-4 py-2.5 rounded-lg hover:bg-red-50 hover:text-red-600 hover:translate-x-1 text-slate-800 text-xs font-medium transition-all duration-200"
                  >
                    {item}
                  </a>
                ))
              }
            </div>
          </div>
        </li>

        <li class="group relative">
          <a
            href="/yifang-academy"
            class="nav-link px-4 py-2 flex items-center transition-all duration-300 hover:text-red-500"
          >
            Yifang Academy
          </a>
        </li>

        <li class="group relative">
          <a
            href="/career"
            class="nav-link px-4 py-2 flex items-center transition-all duration-300 hover:text-red-500"
          >
            Career
          </a>
        </li>
        <li class="group relative">
          <a
            href="/blogs"
            class="nav-link px-4 py-2 flex items-center transition-all duration-300 hover:text-red-500"
          >
            Blogs
          </a>
        </li>
        <li class="group relative">
          <a
            href="/contact"
            class="nav-link px-4 py-2 flex items-center transition-all duration-300 hover:text-red-500"
          >
            Contact us
          </a>
        </li>

        <li class="ml-4">
          <a
            href="#"
            class="px-5 py-2 border border-white/30 rounded-full hover:bg-white hover:text-slate-900 hover:border-white transition-all duration-300 text-xs active:scale-95 inline-block"
          >
            简体中文
          </a>
        </li>
      </ul>
    </nav>

    <button
      id="menu-btn"
      class="p-2 text-white md:hidden transition-colors duration-300 focus:outline-none active:scale-90"
    >
      <div
        id="hamburger"
        class="w-5 h-3.5 relative flex flex-col justify-between"
      >
        <span
          class="w-full h-0.5 bg-current transition-all duration-300 origin-center"
        ></span>
        <span class="w-full h-0.5 bg-current transition-all duration-300"
        ></span>
        <span
          class="w-full h-0.5 bg-current transition-all duration-300 origin-center"
        ></span>
      </div>
    </button>
  </div>

  <div
    id="mobile-menu"
    class="max-h-0 overflow-hidden bg-white md:hidden transition-all duration-500 ease-in-out shadow-2xl"
  >
    <nav
      class="flex flex-col px-6 py-6 text-slate-800 text-sm font-semibold gap-1"
    >
      <a
        href="/"
        class="mobile-link group/m py-4 px-4 flex items-center justify-between rounded-xl transition-all duration-300 hover:bg-red-50 hover:text-red-600 active:bg-red-100"
      >
        <span
          class="transition-transform duration-300 group-hover/m:translate-x-2"
          >Home</span
        >
        <span
          class="active-dot opacity-0 w-1.5 h-1.5 bg-red-600 rounded-full transition-all duration-500"
        ></span>
      </a>

      <details class="group/mobile">
        <summary
          class="flex items-center justify-between py-4 px-4 rounded-xl list-none cursor-pointer transition-all duration-300 hover:bg-slate-50 active:bg-slate-100 group-open/mobile:text-red-600"
        >
          <span>Our Companies</span>
          <span
            class="text-[10px] transition-transform duration-300 group-open/mobile:rotate-180"
            >▼</span
          >
        </summary>
        <div
          class="flex flex-col gap-1 py-2 pl-6 pr-2 bg-slate-50/50 rounded-b-xl overflow-hidden animate-in fade-in slide-in-from-top-2 duration-300"
        >
          {
            ["YSM", "YCME", "YEV", "YAM"].map((item) => (
              <a
                href={`/companies/${item.toLowerCase()}`}
                class="mobile-link py-3 px-4 rounded-lg text-slate-500 text-xs transition-all duration-300 hover:text-red-600 hover:bg-white hover:translate-x-2"
              >
                {item}
              </a>
            ))
          }
        </div>
      </details>

      <a
        href="/yifang-academy"
        class="mobile-link group/m py-4 px-4 flex items-center justify-between rounded-xl transition-all duration-300 hover:bg-red-50 hover:text-red-600 active:bg-red-100"
      >
        <span
          class="transition-transform duration-300 group-hover/m:translate-x-2"
          >Yifang Academy</span
        >
        <span
          class="active-dot opacity-0 w-1.5 h-1.5 bg-red-600 rounded-full transition-all duration-500"
        ></span>
      </a>

      <a
        href="/career"
        class="mobile-link group/m py-4 px-4 flex items-center justify-between rounded-xl transition-all duration-300 hover:bg-red-50 hover:text-red-600 active:bg-red-100"
      >
        <span
          class="transition-transform duration-300 group-hover/m:translate-x-2"
          >Career</span
        >
        <span
          class="active-dot opacity-0 w-1.5 h-1.5 bg-red-600 rounded-full transition-all duration-500"
        ></span>
      </a>
      <a
        href="/blogs"
        class="mobile-link group/m py-4 px-4 flex items-center justify-between rounded-xl transition-all duration-300 hover:bg-red-50 hover:text-red-600 active:bg-red-100"
      >
        <span
          class="transition-transform duration-300 group-hover/m:translate-x-2"
          >Blogs</span
        >
        <span
          class="active-dot opacity-0 w-1.5 h-1.5 bg-red-600 rounded-full transition-all duration-500"
        ></span>
      </a>
      <a
        href="/contact"
        class="mobile-link group/m py-4 px-4 flex items-center justify-between rounded-xl transition-all duration-300 hover:bg-red-50 hover:text-red-600 active:bg-red-100"
      >
        <span
          class="transition-transform duration-300 group-hover/m:translate-x-2"
          >Contact us</span
        >
        <span
          class="active-dot opacity-0 w-1.5 h-1.5 bg-red-600 rounded-full transition-all duration-500"
        ></span>
      </a>
    </nav>
  </div>
</header>

<script is:inline>
  function initNavigation() {
    const header = document.getElementById("main-header");
    const menuBtn = document.getElementById("menu-btn");
    const menu = document.getElementById("mobile-menu");
    const desktopLinks = document.querySelectorAll(".nav-link");
    const mobileLinks = document.querySelectorAll(".mobile-link");
    const hamburgerSpans = document.querySelectorAll("#hamburger span");
    const currentPath = window.location.pathname;

    function setActiveState() {
      desktopLinks.forEach((link) => {
        const href = link.getAttribute("href");
        const li = link.closest("li");
        if (
          href &&
          (currentPath === href ||
            (href !== "/" && currentPath.startsWith(href)))
        ) {
          li?.classList.add("active");
        } else {
          li?.classList.remove("active");
        }
      });

      mobileLinks.forEach((link) => {
        const href = link.getAttribute("href");
        const dot = link.querySelector(".active-dot");
        if (
          href &&
          (currentPath === href ||
            (href !== "/" && currentPath.startsWith(href)))
        ) {
          link.classList.add("text-red-600", "bg-red-50");
          if (dot) dot.style.opacity = "1";
        } else {
          link.classList.remove("text-red-600", "bg-red-50");
          if (dot) dot.style.opacity = "0";
        }
      });
    }

    function toggleMenu(forceClose = false) {
      const isOpened =
        menu.style.maxHeight !== "0px" && menu.style.maxHeight !== "";
      if (isOpened || forceClose) {
        menu.style.maxHeight = "0px";
        hamburgerSpans[0].classList.remove("rotate-45", "translate-y-1.5");
        hamburgerSpans[1].classList.remove("opacity-0");
        hamburgerSpans[2].classList.remove("-rotate-45", "-translate-y-1.5");
      } else {
        menu.style.maxHeight = "600px";
        hamburgerSpans[0].classList.add("rotate-45", "translate-y-1.5");
        hamburgerSpans[1].classList.add("opacity-0");
        hamburgerSpans[2].classList.add("-rotate-45", "-translate-y-1.5");
      }
    }

    menuBtn?.addEventListener("click", () => toggleMenu());

    window.addEventListener("scroll", () => {
      if (window.scrollY > 30) {
        header.classList.add(
          "bg-black/20",
          "backdrop-blur-xl",
          "border-slate-200",
          "shadow-sm",
          "py-2"
        );
        header.classList.remove("py-3", "md:py-4");
        header
          .querySelectorAll(".nav-brand, .nav-link, #menu-btn")
          .forEach((el) => {
            // el.classList.add("text-slate-900");
            // el.classList.remove("text-white");
          });
      } else {
        header.classList.remove(
          "bg-black/20",
          "backdrop-blur-xl",
          "border-slate-200",
          "shadow-sm",
          "py-2"
        );
        header.classList.add("py-3", "md:py-4");
        header
          .querySelectorAll(".nav-brand, .nav-link, #menu-btn")
          .forEach((el) => {
            el.classList.add("text-white");
            // el.classList.remove("text-slate-900");
          });
      }
    });

    setActiveState();
  }

  initNavigation();
  document.addEventListener("astro:after-swap", initNavigation);
</script>

<style>
  /* Desktop Underline Effect */
  .nav-link {
    position: relative;
    height: 40px;
    display: flex;
    align-items: center;
  }
  .nav-link::after {
    content: "";
    position: absolute;
    bottom: 4px;
    left: 1rem;
    right: 1rem;
    height: 2px;
    background-color: #cc0000;
    transform: scaleX(0);
    transition: transform 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
  }
  .group:hover .nav-link::after,
  li.active .nav-link::after {
    transform: scaleX(1);
  }

  /* Mobile Active Feedback */
  .mobile-link {
    -webkit-tap-highlight-color: transparent;
  }

  /* Smooth Blur */
  header.bg-white\/90 {
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
  }

  /* Details Reset */
  details summary::-webkit-details-marker {
    display: none;
  }
  summary {
    outline: none;
  }
</style>
